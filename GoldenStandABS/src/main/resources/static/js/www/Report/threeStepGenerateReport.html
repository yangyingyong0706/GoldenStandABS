<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="renderer" content="webkit" />
    <title>三部生成产品年度报告</title>
    <link href="../../asset/font/fontello/css/fontello.css" rel="stylesheet" />
    <link href="../../asset/lib/Kendo/styles/kendo.common-material.min.css" rel="stylesheet" />
    <link href="../../asset/lib/Kendo/styles/kendo.material.min.css" rel="stylesheet" />
    <link href="../../asset/lib/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="../../asset/font/font-awesome/css/font-awesome.min.css" rel="stylesheet" />
    <link href="../../asset/allstylesheet/index.css" rel="stylesheet" />
    <link href="ReportGrid.css" rel="stylesheet" />
    <script src="../../asset/lib/goldenstand/Kendo/jszip.js"></script>

    <style>
        html, #app {
            height: 100%;
        }
        body {
            background-color: #fbfbfb;
            padding: 10px 15px;
            height: 100%;
        }
        .codeDate {
            font-size:16px;
            font-family:"微软雅黑";
            font-weight:400;
            color:rgba(77,77,77,1);
        }
        #brandNav {
            width:100%;
            height:60px;
            line-height: 60px;
            background:rgba(243,245,250,1);
            margin: 15px 0;
        }
        #brandNav ul li {
            display: inline-block;
            cursor: pointer;
        }
        #brandNav ul li span.circle {
            display: inline-block;
            width:21px;
            height:21px;
            line-height: 20px;
            text-align: center;
            border:1px solid rgba(153,153,153,1);
            border-radius:50%;
            margin-right: 8px;
        }
        #brandNav ul li span.word {
            font-size:14px;
            font-weight:400;
            color:rgba(76,76,76,1);
        }
        #brandNav ul li span.line {
            display: inline-block;
            width:80px;
            height:1px;
            background:rgba(128,128,128,1);
            position: relative;
            top: -4px;
            margin: 0 8px;
        }
        #brandNav ul li.active span.word{
            color: rgba(69,86,156,1);
        }
        #brandNav ul li.active span.circle{
            background:rgba(69,86,156,1);
            color: #ffffff;
        }
        label {
            margin-bottom: 15px;
            font-weight: 400;
            width: 30%;
            background: #f3f5fa;
            height: 30px;
            line-height: 30px;
            padding: 0 0 0 15px;
            color: #888888;
            border: 1px solid #E6E9F5;
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
        }

        .col-sm-6 {
            padding: 0;
            padding-right: 10px;
        }
        /*.col-sm-6:nth-child(2n+1) {
                padding-right: 10px;
            }*/

        /*.col-sm-6:nth-child(2n) {
                padding-left: 10px;
            }*/

        .asset_overview_main input[type=text], .asset_overview_main select {
            width: 60%;
            border: 1px solid #E6E9F5;
            height: 30px;
            line-height: 30px;
            padding: 0 10px;
        }

        .asset_overview_main textarea {
            width: 60%;
            border: 1px solid #E6E9F5;
            height: 75px;
            line-height: 20px;
            padding: 0 10px;
        }

        .asset_overview_main div .DatePlug {
            width: 100%;
        }

        .asset_overview_main {
            border: 1px solid #E6E9F5;
            padding: 15px 15px 0;
        }

        .input_box.col-sm-6 > div {
            height: 30px;
            line-height: 30px;
        }

        input[type=radio], input[type=checkbox] {
            display: inline-block;
            margin: -3px 5px 0 15px;
            vertical-align: middle;
        }

        .input_box.col-sm-6 > div, .input_box.col-sm-6 > label {
            float: left;
        }

        .saveBtn {
            width: 100%;
            text-align: center;
            margin: 20px 0;
        }
        #editItem {
            height: calc(100% - 115px);
            overflow-y: auto;
            padding: 15px;
            background:rgba(255,255,255,1);
            box-shadow:0px 2px 6px 0px rgba(88,104,217,0.2);
        }
        #editItem textarea, #editItem input[type=text] {
            border:1px solid rgba(230,233,245,1);
            border-radius:0px 2px 2px 0px;
            width: 70%;
            height: 30px;
            line-height: 30px;
            resize: none;
            padding: 0 10px;
            color:rgba(77,77,77,1);
            outline: none;
        }
        .statusDiv {
            height:50px;
            background:rgba(255,255,255,1);
            box-shadow:0px 2px 6px 0px rgba(88,104,217,0.2);
            margin: 0 0 15px 0;
            line-height: 30px;
            padding: 10px 15px;
        }
        .statusDiv i.icon {
            margin-right: 10px;
        }
         .statusDiv .greenColor {
             color:rgba(70,174,48,1);
         }
         .statusDiv .tips {
             color: #888;
             margin-left: 10px;
         }
         #pullData, #generateReport {
             height: 100%;
         }
         .pullDataTable {
             background: #fff;
             padding: 15px;
             margin-top: 15px;
             height: calc(100% - 180px);
             overflow-y: auto;
             box-shadow:0px 2px 6px 0px rgba(88,104,217,0.2);
         }
         .pullDataTable table {
             border:1px solid rgba(230,233,245,1);
         }
         .pullDataTable thead tr{
             height:40px;
             background:rgba(243,245,250,1);
         }
         .pullDataTable table tr td{
            padding: 10px 30px;
            color:rgba(77,77,77,1);
            border:1px solid rgba(230,233,245,1);
         }
         .badgeStatus {
             color:rgba(77,77,77,1);
             position: relative;
             padding-left: 20px;
         }
         .badgeStatus:before {
            content: ' ';
            position: absolute;
            left: 1px;
            top: 6px;
            width: 6px;
            height: 6px;
            background-color: rgba(77,77,77,1);
            border-radius: 3px;
         }
         .badgeStatus.badge-info {
             color:rgba(74,176,52,1);
         }
         .badgeStatus.badge-denger {
             color: #dd0000;
         }
         .badgeStatus.badge-denger:before {
             background-color:#dd0000;
         }
         .badgeStatus.badge-info:before {
             background-color:rgba(74,176,52,1);
         }
         .generateDiv {
             padding: 0 15px 15px;
             background: #fff;
             height: calc(100% - 245px);
             overflow-y: auto;
             box-shadow:0px 2px 6px 0px rgba(88,104,217,0.2);
         }
         .imgGenerate {
             padding: 100px 0;
             text-align: center;
         }
         .imgGenerate div{
             margin-top: 15px;
         }
         .GroupClass {
             color: #808080; 
             line-height: 30px;
             position: relative;
             margin-bottom: 15px;
             padding-left: 20px;
             font-size: 16px;
             color: #45569C;
             cursor: pointer;
         }
         .GroupClass:before {
             position: absolute;
             top: 10px;
             left: 0;
             content: ' ';
             width:10px;
             height:10px;
             background:rgba(69,86,156,1);
         }
         #startDateSelect {
            height: 30px;
            line-height: 30px;
            width: 140px;
            margin-left: 10px;
            padding: 4px;
            border: 1px solid #ccc;
            border-radius: 4px;
            position: relative;
            top: 2px;
            font-size: 13px;
            outline: none;
        }
         
        select:disabled{
            background-color: #F5F5F5;
        }
        select[disabled]{
            background-color: #F5F5F5;
        }
        .gd-message-success {
            color: #67c23a;
            background-color: #f0f9eb;
        }
        .gd-message {
            min-width: 380px;
            box-sizing: border-box;
            border-radius: 4px;
            border-width: 1px;
            border-style: solid;
            border-color: #ebeef5;
            position: fixed;
            z-index: 99999;
            left: 50%;
            top: 160px;
            transform: translateX(-50%);
            background-color: #edf2fc;
            transition: opacity 0.3s,transform .4s;
            overflow: hidden;
            padding: 10px 15px;
            display: flex;
            align-items: center;
            font-size: 14px;
        }
        .gd-message i {
            margin-right: 10px;
        }
        .gd-message p {
            margin: 0px;
        }
    </style>

</head>
<body>
    <div id="app">
        <div id="loading" class="loadpage text-center" v-show="loading"><i class="fa fa-spinner fa-pulse fa-4x fa-fw margin-bottom"></i></div>
        <!--头部信息 显示code 日期-->
        <div id="header" > 
            <span class="codeDate">
                {{TrustCode}}
                <!--<span>年报-{{prieodYear}}年</span>-->
            </span>
            <span class="selectDate pull-right">
                请选择年报日期：
                <select id="startDateSelect" v-model="nowDate">
                    <option v-for="item in dateList" v-bind:value="item">{{item}}</option>
                </select>
            </span>
        </div>
        <!--步骤导航条-->
        <div id="brandNav">
            <ul class="pull-left">
                <li v-bind:class="{active: step===0}">
                    <span class="circle">1</span>
                    <span class="word">编辑年报</span>
                    <span class="line"></span>
                </li>
                <li v-bind:class="{active: step===1}">
                    <span class="circle">2</span>
                    <span class="word">获取数据</span>
                    <span class="line"></span>
                </li>
                <li v-bind:class="{active: step===2}">
                    <span class="circle">3</span>
                    <span class="word">生成报告</span>
                </li>
            </ul>
        </div>
        <!--编辑数据-->
        <div id="editItem" v-if="step===0" style="position: relative;">
            <div style="position: absolute;right: 0;top: 0;z-index: 2">
                <button class="pull-right btn btn-primary" style="margin: 10px 15px 10px 5px;" @click="SaveProject">保存</button>
                <button class="pull-right btn btn-default" style="margin: 10px 5px;" @click='goSecond'>下一步</button>
            </div>
            <div class="public_font_style">
                <div class="clearfix">
                    <div style="clear:both" v-for="(GroupName,i) in GroupNames">
                        <div class="GroupClass" @click.passive="toggleNext(i)">{{GroupName}} <i class="icon icon-bottom"></i> </div>
                        <div class="xmlDiv">
                            <div class="input_box col-sm-6" v-for="(Item,Index) in ItemXml" v-if="GroupName==Item.GroupName">
                                <label v-bind:title="Item.ItemCode">{{Item.ItemCode}}</label>
                                <select v-model="Item.ItemValue" v-if="Item.ControlType === 'Select'">
                                    <option>{{Item.ItemValue}}</option>
                                </select>
                                <div style="position: relative;" v-if="Item.ControlType === 'Date'">
                                    <input type="text" class="DatePlug" v-date-plugin v-model="Item.ItemValue" />
                                </div>
                                <input v-model="Item.ItemValue" type="text" v-if="Item.ControlType === 'Text'" />
                                <textarea v-model="Item.ItemValue" v-if="Item.ControlType === 'TextArea'"></textarea>
                                <field-checkbox v-if="Item.ControlType === 'CheckBox'" v-bind:checkbox-data="Item" @child-msg="getChildMsg"></field-checkbox>
                                <field-checkbox v-if="Item.ControlType === 'Radio'" v-bind:checkbox-data="Item" @child-msg="getChildMsg"></field-checkbox>
                                <button class="btn btn-default" v-if="Item.ControlType ==='Table'" @click="QueryAsset(Item.ItemCode,Item.Id,Item.TableCode,Item.ControlData,Item.DataSourceId)">{{Item.ItemCode}}</button>
                                <div v-if="Item.ControlType === 'RadioWhetherText'">
                                    <input type="radio" v-bind:name="Index" value='是' v-model="Item.ItemValue" /> 是
                                    <input type="radio" v-bind:name="Index" value='否' v-model="Item.ItemValue" /> 否
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!--获取数据-->
        <div id="pullData" v-if="step===1">
            <div class="statusDiv">
                <span class="greenColor" v-show="EditStatus"><i class="icon icon-ok"></i> 年报已编辑完成</span>
                <span class="" v-show="!EditStatus"><i class="icon icon-close"></i> 年报未编辑完成</span>
                <span class="tips">可修改</span>
                <button class="btn btn-default pull-right" @click="step=0">返回修改</button>
            </div>
            <!--数据详情-->
            <div class="pullDataTable">
                <div class="table-btn" style="margin-bottom: 15px;">
                    <span>获取数据</span>
                    <div class='btn btn-default pull-right' @click='pullAllData()' style="position: relative; top: -5px;">获取全部数据</div>
                    <button class='btn btn-default pull-right' @click='gothird' style="position: relative; top: -5px;">下一步</button>
                </div>
                <table class="table">
                    <thead>
                        <tr>
                            <td>数据名称</td>
                            <td>完成状态</td>
                            <td>操作</td>
                        </tr>
                    </thead>
                    <tbody>
                        <tr v-for="stateItem in reportDataTemp">
                            <td>{{stateItem.DataSourceDescription}}</td>
                            <td><span class="badgeStatus" v-bind:class="stateItem.state=='1'?'badge-info':stateItem.state=='2'?'badge-denger':''">{{stateItem.state=="1"?"已完成":stateItem.state=="2"?"未获取":"未完成"}}</span></td>
                            <td><a @click="pullReportData(stateItem,reportDataTemp.selectedReportId,reportDataTemp.prieodData)" class="oper_btn" href="###">获取数据</a></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <!--生成报告-->
        <div id="generateReport" v-if="step===2">
            <div class="statusDiv">
                <span class="greenColor" v-show="EditStatus"><i class="icon icon-ok"></i> 年报已编辑完成</span>
                <span class="" v-show="!EditStatus"><i class="icon icon-close"></i> 年报未编辑完成</span>
                <span class="tips">可修改</span>
                <button class="btn btn-default pull-right" @click="step=0">返回修改</button>
            </div>
            <div class="statusDiv">
                <span class="greenColor" v-show="getDataStatus"><i class="icon icon-ok"></i> 已获取数据</span>
                <span class="" v-show="!getDataStatus"><i class="icon icon-close"></i> 未获取数据</span>
                <span class="tips">可修改</span>
                <button class="btn btn-default pull-right" @click="step=1">返回重新获取</button>
            </div>
            <div class="generateDiv">
                <div class="table-btn" style="margin-bottom: 15px;border-bottom: 1px solid rgba(220,224,238,1);height: 50px;line-height: 50px;">
                    <span>生成报告</span>
                    <div class='btn btn-default pull-right' @click="GenerateDocClick()" style="position: relative; top: 10px;">生成报告</div>
                </div>
                <div class="imgGenerate">
                    <div v-show="!reportGenerateStatus">
                        <img src="../../asset/img/not_generate.png" />
                        <div>报告待生成，<span style="color: #45569C;cursor: pointer" @click="GenerateDocClick()">生成报告</span></div>
                    </div>
                    <div v-show="reportGenerateStatus">
                        <img src="../../asset/img/have_generate.png" />
                        <div>报告已生成，<span style="color: #45569C;cursor: pointer" @click="exportDataClick()">下载报告</span></div>
                    </div>
                </div>
            </div>
        </div>
        
    </div>
    <script src="../../asset/lib/require.js"></script>
    <script>
        requirejs(['../../asset/lib/config.js'], function (config) {
            requirejs(['app/report/threeStepGenerateReport']);
        });
    </script>
</body>
</html>